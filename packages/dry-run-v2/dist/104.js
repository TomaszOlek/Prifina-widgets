"use strict";(self.webpackChunk_prifina_widgets_dry_run=self.webpackChunk_prifina_widgets_dry_run||[]).push([[104],{3104:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var a=n(1119),r=n(6470),o=n(929),c=n(513),i=n(7162),s=n.n(i),l=(n(9120),n(6781),n(3105),n(5713),n(8695),n(8188),n(1939),n(5734),n(8233),n(8995),n(8178),n(3450),n(4769),n(2501),n(3430),n(3108),n(7900)),u=n.n(l),f=n(2734),d=n(3280),p=n(4033),m=n(8703),h=n(3854),y=n(3258),g=n(3276),x=n(5556),v=n(3131),F=n(2655),w=n(5484),D=n(4908),E=n(3004),k=n(840),S=n(101),_=n(4992),b=n(4054),C=n(2230),A={width:"300px",height:"300px",background:"linear-gradient(180deg, #0D3D4D 0%, rgba(0, 44, 69, 0.04) 100%), #071833",borderRadius:"10px",boxShadow:"0px 2px 8px rgba(91, 92, 91, 0.2)",padding:8,flexDirection:"column"};const O=function(e){var t=(0,f.usePrifina)(),n=t.stage,i=t.onUpdate,O=t.API,I=t.registerDataConnector,P=e.city,T=e.data,Z=(0,l.useState)({}),z=(0,c.Z)(Z,2),j=z[0],M=z[1],R=(0,l.useState)(0),W=(0,c.Z)(R,2),q=W[0],B=W[1],J=function(e){console.log("DATA",e);var t=[];if("dev"===n){var a=e.split(","),r={day_start:a[2],class_5min:a[28]};console.log(r);var o=new Date(r.day_start);t.push(["day_start","class_5min"].join(","));for(var c=0;c<7;c++){var i=o.setDate(o.getDate()-1),s=Object.assign({},r);s.day_start=new Date(i).toISOString(),t.push([s.day_start,s.class_5min].join(",")),o=new Date(i)}}else t=e;t.shift(),console.log("PROCESS ",t);var l={};t.forEach((function(e){console.log("DD ",e);var t=e.split(",");console.log("PARTS ",t);var n=new Date(t[0]).getTime();t[1].split("").forEach((function(e,t){var a=new Date(n+5*t*60*1e3),r=a.getDay(),o=a.getHours().toString().padStart(2,"0")+":00";l.hasOwnProperty(r)||(l[r]={}),l[r].hasOwnProperty(o)||(l[r][o]=0),parseInt(e)>2&&l[r][o]++}))})),console.log(l),M(l)},K=P||"london";void 0!==T&&T.hasOwnProperty("settings")&&"object"===(0,o.Z)(T.settings)&&T.settings.hasOwnProperty("city")&&T.settings.city.length>0&&(K=T.settings.city);var L=(0,l.useState)(K),U=(0,c.Z)(L,2),$=U[0],N=U[1],G=function(){var e=(0,r.Z)(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("UPDATE ",t),t.hasOwnProperty("settings")&&"object"===(0,o.Z)(T.settings)&&t.settings.hasOwnProperty("city")&&(N(t.settings.city),X("".concat(_.C,"/data/2.5/onecall?q=").concat(T.settings.city,"&units=metric&appid=").concat(_.$))),t.hasOwnProperty("data")&&t.data.hasOwnProperty("content")&&"Oura/queryActivitySummariesAsync"===t.data.dataconnector&&t.data.content.length>1&&J(t.data.content);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){function e(){return(e=(0,r.Z)(s().mark((function e(){var t,r,o,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(C.A,G),I(C.A,[d.Z]),t=new Date,r=t.setDate(t.getDate()-14),o=new Date(r).toISOString().split("T")[0],c=(0,a.Z)({},"s3::date",(0,a.Z)({},f.Op.gte,o)),e.next=8,O[C.A].Oura.queryActivitySummariesAsync({filter:c,fields:"day_start,class_5min"});case 8:l=e.sent,console.log(l),"dev"===n&&J(l.data.getDataObject.content[1]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var H=(0,S.Z)("".concat(_.C,"/v1/forecast.json?key=").concat(_.$,"&q=").concat($,"&days=7&aqi=no&alerts=no")),Y=H.weatherData,Q=H.error,V=H.isLoading,X=H.setUrl;if(Q)return u().createElement("h2",null,"Error when fetching: ",Q);if(!Y&&V)return u().createElement("h2",null,"LOADING...");if(!Y)return null;var ee=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.split(":"),r=parseInt(a[0]);return r>0&&r<12?r+(-1===t?":"+a[1]:"")+(n?"AM":""):r>12&&r<24?r-12+(-1===t?":"+a[1]:"")+(n?"PM":""):12===r?r+(-1===t?":"+a[1]:"")+(n?"PM":""):24===r||0===r?"12"+(-1===t?":"+a[1]:"")+(n?"AM":""):void 0},te=Y.forecast.forecastday[q],ne=new Date(te.date).getDay(),ae=-1,re=[];j.hasOwnProperty(ne)&&(re=Object.keys(j[ne]).map((function(e){var t={};return t[e]=j[ne][e],t})).sort((function(e,t){var n=Object.keys(e)[0],a=Object.keys(t)[0];return e[n]<t[a]?1:e[n]>t[a]?-1:0})).slice(0,3));var oe=100;if(re.length>0){console.log(re);for(var ce=0;ce<Y.forecast.forecastday[q].hour.length;ce++)for(var ie=0,se=0;se<re.length;se++){var le=Object.keys(re[se])[0],ue=Y.forecast.forecastday[q].hour[ce],fe=ue.time.split(" ")[1];fe===le&&(console.log(fe,le,re[se][le],ie),ue.chance_of_rain+ue.chance_of_snow<=oe&&re[se][le]>ie&&(ie=re[se][le],ae=parseInt(le),oe=ue.chance_of_rain+ue.chance_of_snow))}console.log("RAIN % ",oe)}if(-1===ae||oe>20){var de=Y.forecast.forecastday[q].hour.slice(6,20).reduce((function(e,t){return e.chance_of_rain<t.chance_of_rain+t.chance_of_snow?e:t})).time;ae=new Date(de).getHours()}return u().createElement(u().Fragment,null,u().createElement(p.kC,{alt:"container",style:A,flex:1},u().createElement(p.xv,{fontSize:"16px",color:"#FFFFFF",fontWeight:"bold",textTransform:"uppercase"},"//Dry run//"),u().createElement(h.II,{h:"28px",marginTop:"12px",focusBorderColor:"transparent",bg:"#07263E",borderWidth:0,color:"#90CDF4",fontSize:"18px",textTransform:"uppercase",fontWeight:"bold",fontStyle:"italic",borderRadius:"2px",value:$,readOnly:!0}),function(){var e=Y.forecast.forecastday.map((function(e){return{icon:e.day.condition.icon,date:e.date}})),t=new Date(e[q].date);return u().createElement(p.kC,{flexDirection:"column"},u().createElement(p.kC,{justifyContent:"center"},e.map((function(e,t){return u().createElement(p.kC,{key:"w-"+t,flexDirection:"column",alignItems:"center","data-weather-day":t,onClick:function(e){return t=e,n=parseInt(t.currentTarget.dataset.weatherDay),void(q!=n?B(n):t.preventDefault());var t,n},style:{cursor:"pointer"}},u().createElement(m.Ee,{src:e.icon,boxSize:"40px"}),u().createElement(p.xv,{color:"#FFF500",fontWeight:"700",fontSize:"12px"},b.zm[new Date(e.date).getDay()]))}))),u().createElement(p.xv,{fontSize:"18px",textTransform:"uppercase",fontWeight:"bold",fontStyle:"italic",color:"#FFFFFF"},b.an[t.getDay()],", ",t.getDate()," ",b.e7[t.getMonth()]))}(),u().createElement(p.kC,{alt:"bottomContainer",flexDirection:"column"},function(){var e=Y.forecast.forecastday[q],t=new Date(e.date).getDay();console.log("FORECAST DAY",t);var n=0,r=e.hour.map((function(e){var a=e.time.split(" ")[1],r=0;return j.hasOwnProperty(t)&&j[t].hasOwnProperty(a)&&(r=j[t][a]),n=Math.max(n,r),{hour:e.time.split(" ")[1],chance_of_rain:(e.chance_of_rain+e.chance_of_snow)/2,activity:r}}));return u().createElement(y.h,{width:"99%",aspect:3},u().createElement(g.c,{data:r,borderWidth:0,margin:{left:-55,right:-55,top:10}},u().createElement(x.K,{stroke:"#90CDF4",dataKey:"hour",fontSize:"12px",tickFormatter:ee,tick:{fontSize:10}}),u().createElement(v.B,{yAxisId:"left",orientation:"left",tick:!1,domain:[0,100]}),u().createElement(v.B,{yAxisId:"right",orientation:"right",tick:!1,domain:[0,n]}),u().createElement(F.u,null),u().createElement(w.q,(0,a.Z)({stroke:"#f5f5f5"},"stroke","none")),u().createElement(D.$,{dataKey:"chance_of_rain",yAxisId:"left",name:"Chance of rain",barSize:3,fill:"#90CDF4",radius:3,maxBarSize:4}),u().createElement(E.x,{yAxisId:"right",type:"step",dataKey:"activity",name:"Activity",stroke:"#FFF500",dot:!1}),u().createElement(k.d,{yAxisId:"left",x:"06:00",stroke:"#808080"}),u().createElement(k.d,{yAxisId:"left",x:"12:00",stroke:"#808080"}),u().createElement(k.d,{yAxisId:"left",x:"18:00",stroke:"#808080"})))}(),u().createElement(p.kC,{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},u().createElement(p.kC,{flexDirection:"column"},u().createElement(p.kC,{alignItems:"center"},u().createElement(p.kC,{w:"7px",h:"7px",background:"#90CDF4",borderRadius:999,marginRight:"4px"}),u().createElement(p.xv,{color:"#FFFFFF",fontSize:10,textTransform:"uppercase"},"Chance of rain")),u().createElement(p.kC,{alignItems:"center"},u().createElement(p.kC,{w:"7px",h:"7px",background:"#FFF500",borderRadius:999,marginRight:"4px"}),u().createElement(p.xv,{color:"#FFFFFF",fontSize:10,textTransform:"uppercase"},"Activity history"))),u().createElement(p.kC,{flexDirection:"column",alignItems:"center"},u().createElement(p.xv,{fontSize:"18px",color:"#FFFFFF",fontWeight:"700"},"".concat(ee(ae+":00",-1,!1)," - ").concat(ee(ae+1+":00",-1,!0))),u().createElement(p.xv,{textTransform:"uppercase",color:"#FFF500",fontSize:10},"Optimal workout time"))))))}},4992:(e,t,n)=>{n.d(t,{$:()=>a,C:()=>r});var a="e72f4e2b049a4ca7918223846212007",r="http://api.weatherapi.com"},2230:(e,t,n)=>{n.d(t,{A:()=>a});var a="x3LSdcSs1kcPskBWBJvqGto"},101:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(513),r=(n(8188),n(3439),n(7900));const o=function(e){var t=(0,r.useState)(null),n=(0,a.Z)(t,2),o=n[0],c=n[1],i=(0,r.useState)(null),s=(0,a.Z)(i,2),l=s[0],u=s[1],f=(0,r.useState)(null),d=(0,a.Z)(f,2),p=d[0],m=d[1],h=(0,r.useState)(e),y=(0,a.Z)(h,2),g=y[0],x=y[1];return(0,r.useEffect)((function(){g&&(m(!0),c(null),u(null),fetch(g).then((function(e){return e.json()})).then((function(e){m(!1),e.cod>=400?u(e.message):c(e)})).catch((function(e){m(!1),u(e)})))}),[g]),{weatherData:o,error:l,isLoading:p,setUrl:x}}},4054:(e,t,n)=>{n.d(t,{an:()=>a,zm:()=>r,e7:()=>o});var a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=["Sun","Mon","Thu","Wed","Thu","Fri","Sat"],o=["January","February","March","April","May","June","July","August","September","October","November","December"]}}]);